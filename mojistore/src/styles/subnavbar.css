/* ==========================================================================
   MojiStore — SubNavbar (dropdown list: boxes, up to 3 cols, no inner scroll)
   ========================================================================== */

.ms-subnav{
  /* Keep the subnav visible below the sticky navbar by sticking it
     to the top of the viewport offset by the navbar height. This
     prevents the navbar from overlapping / hiding the subnav. */
  position: sticky;
  top: var(--navbar-row-h); /* match Navbar row height variable */
  z-index: var(--z-subnav);
  width: 100%;
  background: var(--color-bg);
  border-bottom: 1px solid var(--color-border);
  backdrop-filter: blur(10px) saturate(120%);
  /* absolutely-positioned menus can’t create sideways scroll */
  overflow-x: clip;
  overflow-y: visible;
}



/* Row of category pills */
.ms-subnav .row{
  --base-pad-bottom: .95rem;     /* base bottom space under pills */
  --row-gap: clamp(.6rem, 1.4vw, .6rem); /* expose row gap for JS/CSS math */

  display:flex;
  flex-wrap:wrap;

  /* separate horizontal/vertical gaps so we can open the space between rows */
  column-gap:.6rem;                  /* horizontal spacing between pills */
  row-gap:var(--row-gap);            /* vertical spacing between rows */

  /* top | left&right | bottom — add L/R padding and more bottom space */
  padding:.6rem clamp(.5rem, 2vw, .3rem) var(--base-pad-bottom);
  align-items:center;
  position:relative;
  background: var(--color-bg); /* lets the mask blend perfectly */
}

/* compact location picker inside subnav (visible on mobile/tablet) */
/* subnav location picker is provided by the shared LocationPicker component */

.ms-subnav .ms-cat{ position:relative; display:inline-block; }

/* Pill */
.ms-subnav .ms-pill{
  display:inline-flex; align-items:center; white-space:nowrap;
  border:1px solid var(--color-border);
  background:var(--color-surface);
  color:var(--color-text);
  padding:.42rem .8rem;              /* sleeker pill */
  border-radius:var(--r-btn);
  font-size:.9rem;
  text-decoration:none;
  transition: border-color .15s ease, background-color .15s ease, color .15s ease, transform .15s ease;
}
.ms-subnav .ms-pill:hover{
  transform: translateY(-1px);
  border-color: color-mix(in oklab, var(--color-border) 60%, var(--color-accent));
  background: var(--color-surface-2);
}

/* Active pill (when on /products?category=ID) */
.ms-subnav .ms-pill.is-active,
.ms-subnav .ms-pill[aria-current="page"]{
  border-color: var(--color-accent);
  background: color-mix(in oklab, var(--color-surface) 75%, var(--color-accent));
  color: var(--color-text);
}

/* Dropdown anchor (directly below) */
.ms-subnav .ms-mega{
  position:absolute;
  top: calc(100% + 6px); /* small visual gap to separate from pill row */
  left:0;                /* default: align under start of pill */
  display:none;
  z-index: var(--z-dropdown);
  pointer-events:none;
  max-width: 100vw;
}

/* Hover bridge to keep :hover alive while moving to menu */
.ms-subnav .ms-mega::before{
  content:"";
  position:absolute;
  left:0; right:0; top:-8px;
  height:8px;
}

/* Open states */
.ms-subnav .ms-cat:hover > .ms-mega,
.ms-subnav .ms-cat:focus-within > .ms-mega,
.ms-subnav .ms-cat[data-open="1"] > .ms-mega,
.ms-subnav .ms-mega.is-open{
  display:block !important;
  pointer-events:auto;
}

/* Alignment control (toggled by JS to avoid right overflow) */
.ms-subnav .ms-mega[data-align="end"]{ left:auto; right:0; }
.ms-subnav .ms-mega[data-align="center"]{ left:50%; transform: translateX(-50%); }

/* Menu card — width derives from column count; no inner scrollbar */
.ms-subnav .ms-mega-card{
  --cols: 1;                          /* JS sets 1..3 */
  --rows: 7;                          /* JS bumps if > 21 items */
  --col-min: 210px;
  --gap-x: 12px;
  --gap-y: 8px;

  inline-size: fit-content;           /* shrink to fit content */
  min-inline-size: calc(var(--cols) * var(--col-min) + (var(--cols) - 1) * var(--gap-x));
  max-inline-size: min(96vw, calc(var(--cols) * 280px + (var(--cols) - 1) * var(--gap-x)));
  /* no max-height and no overflow → no inner scrollbar */
  overflow: visible;

  padding:.75rem;
  background:var(--color-surface);
  border:1px solid var(--color-border);
  border-radius:var(--r-card);
  box-shadow: var(--shadow-1);
  will-change: transform, opacity;
  animation: msMegaIn .14s ease-out both;
}

/* Title */
.ms-subnav .ms-mega-title{
  font-size:.72rem; font-weight:700; letter-spacing:.08em;
  color:var(--color-muted);
  padding:.2rem .25rem .55rem;
}

/* List grid: fill down first, then across; max 3 columns */
.ms-subnav .ms-mega-grid{
  display:grid;
  grid-auto-flow: column;  /* fill rows first */
  grid-template-rows: repeat(var(--rows), auto);
  grid-template-columns: repeat(var(--cols), minmax(var(--col-min), 1fr));
  gap: var(--gap-y) var(--gap-x);
  align-items:start;
}

/* Item boxes (boxed even without hover) */
.ms-subnav .ms-mega-item{
  display:block;
  padding:.55rem .7rem;
  border-radius:12px;
  border:1px solid var(--color-border);
  background: var(--color-surface-2);
  color:var(--color-text);
  text-decoration:none;
  transition: background-color .12s ease, border-color .12s ease, color .12s ease, transform .12s ease;
}
.ms-subnav .ms-mega-item:hover,
.ms-subnav .ms-mega-item:focus{
  background: color-mix(in oklab, var(--color-surface-2) 70%, var(--color-accent));
  border-color: var(--color-accent);
  transform: translateY(-1px);
  outline:none;
}

/* Subtle intro */
@keyframes msMegaIn{
  from{ opacity:0; transform: translateY(-6px) scale(.985); }
  to{   opacity:1; transform: translateY(0)    scale(1); }
}
@media (prefers-reduced-motion: reduce){
  .ms-subnav .ms-mega-card{ animation:none; }
}

/* ==== Collapsible row toggle (arrow) ===================================== */
.ms-subnav .row[data-collapsed="1"]{
  position: relative;
  overflow: visible; /* don't clip dropdowns */

  /* comfy collapsed spacing:
     - JS provides --first-row-h (actual first row height incl. gap)
  */
  --collapsed-extra: .40rem;
  max-height: calc(var(--first-row-h, 0px) + var(--collapsed-extra));
  padding-bottom: var(--base-pad-bottom);
}

/* Opaque visual mask to hide wrapped pills (not dropdowns) */
.ms-subnav .row[data-collapsed="1"]::after{
  content:"";
  position:absolute;
  left:0; right:0;
  /* use exact clamp edge from JS (bottom of row-1 + row-gap) */
  top: var(--first-row-edge, var(--first-row-h, 0px));
  bottom:-1px;
  background: var(--color-bg);   /* same as subnav background */
  /* allow clicks to pass through to the toggle button (hidden pills are disabled by .is-below) */
  pointer-events: none;
  z-index: calc(var(--z-dropdown) - 2); /* under dropdown, under toggle */
}

/* Disable interaction / fully hide second+ row pills while collapsed */
.ms-subnav .row[data-collapsed="1"] .ms-cat.is-below{
  pointer-events: none;
  visibility: hidden; /* guarantees no peeking at edges */
}

/* Arrow overlay container */
.ms-subnav .ms-row-toggle {
  position: absolute;
  top: 0;
  /* align the arrow to the same inset as the row’s right padding */
  right: clamp(.5rem, 2vw, 1.25rem);

  /* match first-row height via inline style (JS sets height), with sensible fallback */
  height: 2.4rem;
  display: flex;
  align-items: center;
  padding-left: 18px; /* space for gradient */

  /* sit above the mask (same token as dropdown is fine) */
  z-index: var(--z-dropdown);

  /* Gentle fade to make the arrow feel "at end of the row" */
  background: linear-gradient(
    to right,
    color-mix(in oklab, var(--color-bg) 0%, transparent) 0%,
    var(--color-bg) 42%,
    var(--color-bg) 100%
  );
}

.ms-subnav .ms-row-toggle-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 28px;
  width: 28px;
  margin: 0; /* ensure no extra offset */
  border-radius: var(--r-btn);
  border: 1px solid var(--color-border);
  background: var(--color-surface);
  color: var(--color-text);
  transition: transform .12s ease, background-color .12s ease, border-color .12s ease;
  cursor: pointer;
}
.ms-subnav .ms-row-toggle-btn:hover {
  transform: translateY(-1px);
  background: color-mix(in oklab, var(--color-surface) 75%, var(--color-accent));
  border-color: var(--color-accent);
}

/* Trim extra space only when expanded */
.ms-subnav .row[data-collapsed="0"]{
  padding-bottom: .4rem; /* adjust to taste */
}
/* When all categories fit on one line, distribute space evenly across the row */
.ms-subnav .row[data-single="1"]{
  justify-content: space-evenly;  /* equal space before, between, after pills */
  column-gap: 0;                  /* avoid double-spacing with flex “evenly” */
}

/* === Debug / safety helpers for the row-toggle (remove when resolved) === */
/* Ensure the toggle sits above the collapse mask and accepts clicks */
.ms-subnav .ms-row-toggle{
  pointer-events: auto !important; /* ensure it receives clicks */
  z-index: calc(var(--z-dropdown) + 2) !important; /* above mask/dropdown */
}
.ms-subnav .ms-row-toggle-btn{
  position: relative;
  z-index: calc(var(--z-dropdown) + 3) !important;
  /* optional visual aid during debugging:
  outline: 2px solid rgba(255,255,0,0.35);
  */
}

/* Keep the mask under the toggle so it doesn't intercept clicks */
.ms-subnav .row[data-collapsed="1"]::after{
  z-index: calc(var(--z-dropdown) - 2) !important;
}

